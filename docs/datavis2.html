<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Analysis in Social Science 3</title>
  <meta name="description" content="A website for the Data Analysis in Social Science 3 module.">
  <meta name="generator" content="bookdown 0.6 and GitBook 2.6.7">

  <meta property="og:title" content="Data Analysis in Social Science 3" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://abessudnov.net/dataanalysis3/" />
  
  <meta property="og:description" content="A website for the Data Analysis in Social Science 3 module." />
  <meta name="github-repo" content="abessudnov/dataanalysis3" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Analysis in Social Science 3" />
  
  <meta name="twitter:description" content="A website for the Data Analysis in Social Science 3 module." />
  

<meta name="author" content="Alexey Bessudnov">


<meta name="date" content="2018-03-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="datavis.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113869422-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113869422-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#things-to-do-before-the-next-class"><i class="fa fa-check"></i><b>1.1</b> Things to do before the next class</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-outline.html"><a href="module-outline.html"><i class="fa fa-check"></i><b>2</b> Module outline</a><ul>
<li class="chapter" data-level="2.1" data-path="module-outline.html"><a href="module-outline.html#practical-arrangements"><i class="fa fa-check"></i><b>2.1</b> Practical arrangements</a></li>
<li class="chapter" data-level="2.2" data-path="module-outline.html"><a href="module-outline.html#aims-of-the-module"><i class="fa fa-check"></i><b>2.2</b> Aims of the module</a></li>
<li class="chapter" data-level="2.3" data-path="module-outline.html"><a href="module-outline.html#attendance"><i class="fa fa-check"></i><b>2.3</b> Attendance</a></li>
<li class="chapter" data-level="2.4" data-path="module-outline.html"><a href="module-outline.html#assessment"><i class="fa fa-check"></i><b>2.4</b> Assessment</a></li>
<li class="chapter" data-level="2.5" data-path="module-outline.html"><a href="module-outline.html#syllabus-plan"><i class="fa fa-check"></i><b>2.5</b> Syllabus plan</a></li>
<li class="chapter" data-level="2.6" data-path="module-outline.html"><a href="module-outline.html#reading-list"><i class="fa fa-check"></i><b>2.6</b> Reading list</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="assignment.html"><a href="assignment.html"><i class="fa fa-check"></i><b>3</b> Assignment</a></li>
<li class="chapter" data-level="4" data-path="joining.html"><a href="joining.html"><i class="fa fa-check"></i><b>4</b> Joining data from the Understanding Society</a><ul>
<li class="chapter" data-level="4.1" data-path="joining.html"><a href="joining.html#joining-waves-1-and-2"><i class="fa fa-check"></i><b>4.1</b> Joining waves 1 and 2</a></li>
<li class="chapter" data-level="4.2" data-path="joining.html"><a href="joining.html#joining-waves-1-to-7"><i class="fa fa-check"></i><b>4.2</b> Joining waves 1 to 7</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>5</b> Tidy data</a><ul>
<li class="chapter" data-level="5.1" data-path="tidy-data.html"><a href="tidy-data.html#long-and-wide-formats"><i class="fa fa-check"></i><b>5.1</b> Long and wide formats</a></li>
<li class="chapter" data-level="5.2" data-path="tidy-data.html"><a href="tidy-data.html#cleaning-the-data"><i class="fa fa-check"></i><b>5.2</b> Cleaning the data</a></li>
<li class="chapter" data-level="5.3" data-path="tidy-data.html"><a href="tidy-data.html#homework"><i class="fa fa-check"></i><b>5.3</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>6</b> Data visualisation</a><ul>
<li class="chapter" data-level="6.1" data-path="datavis.html"><a href="datavis.html#reading-in-the-data"><i class="fa fa-check"></i><b>6.1</b> Reading in the data</a></li>
<li class="chapter" data-level="6.2" data-path="datavis.html"><a href="datavis.html#visualising-one-quantitative-variable"><i class="fa fa-check"></i><b>6.2</b> Visualising one quantitative variable</a><ul>
<li class="chapter" data-level="6.2.1" data-path="datavis.html"><a href="datavis.html#histogram."><i class="fa fa-check"></i><b>6.2.1</b> Histogram.</a></li>
<li class="chapter" data-level="6.2.2" data-path="datavis.html"><a href="datavis.html#density-chart."><i class="fa fa-check"></i><b>6.2.2</b> Density chart.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="datavis.html"><a href="datavis.html#visualising-one-categorical-variable"><i class="fa fa-check"></i><b>6.3</b> Visualising one categorical variable</a><ul>
<li class="chapter" data-level="6.3.1" data-path="datavis.html"><a href="datavis.html#bar-plot."><i class="fa fa-check"></i><b>6.3.1</b> Bar plot.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="datavis.html"><a href="datavis.html#visualising-two-quantitative-variables"><i class="fa fa-check"></i><b>6.4</b> Visualising two quantitative variables</a></li>
<li class="chapter" data-level="6.5" data-path="datavis.html"><a href="datavis.html#visualising-one-categorical-and-one-quantitative-variable"><i class="fa fa-check"></i><b>6.5</b> Visualising one categorical and one quantitative variable</a></li>
<li class="chapter" data-level="6.6" data-path="datavis.html"><a href="datavis.html#visualising-two-categorical-variables"><i class="fa fa-check"></i><b>6.6</b> Visualising two categorical variables</a></li>
<li class="chapter" data-level="6.7" data-path="datavis.html"><a href="datavis.html#showing-the-relationships-by-group"><i class="fa fa-check"></i><b>6.7</b> Showing the relationships by group</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="datavis2.html"><a href="datavis2.html"><i class="fa fa-check"></i><b>7</b> Data visualisation 2</a><ul>
<li class="chapter" data-level="7.1" data-path="datavis2.html"><a href="datavis2.html#prepare-the-data"><i class="fa fa-check"></i><b>7.1</b> Prepare the data</a></li>
<li class="chapter" data-level="7.2" data-path="datavis2.html"><a href="datavis2.html#visualising-income"><i class="fa fa-check"></i><b>7.2</b> Visualising income</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Social Science 3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datavis2" class="section level1">
<h1><span class="header-section-number">7</span> Data visualisation 2</h1>
<blockquote>
<p>Pre-requisite for this class: ch.3 (“Data visualisation”) from R for Data Science - <a href="http://r4ds.had.co.nz/data-visualisation.html" class="uri">http://r4ds.had.co.nz/data-visualisation.html</a></p>
</blockquote>
<blockquote>
<p>Also see the ggplot2 cheat sheet - <a href="https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf</a></p>
</blockquote>
<p>At the previous class we looked at some simple data visualisation techniques (see <a href="http://abessudnov.net/dataanalysis3/datavis.html" class="uri">http://abessudnov.net/dataanalysis3/datavis.html</a>). Now we will explore how we can visualise longitudinal data.</p>
<div id="prepare-the-data" class="section level2">
<h2><span class="header-section-number">7.1</span> Prepare the data</h2>
<p>First we will create a longitudinal data set following the same algorithm as before (<a href="http://abessudnov.net/dataanalysis3/joining.html" class="uri">http://abessudnov.net/dataanalysis3/joining.html</a>). I want to add a variable for income so that we have a longirudinal quantitative variable to visualise. We will use <em>fimnnet_dv</em> (total monthly net personal income without deductions).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(knitr)

files &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;data/UKDA-6614-tab/tab&quot;</span>,
             <span class="dt">pattern=</span><span class="st">&quot;indresp&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>)
files &lt;-<span class="st"> </span>files[<span class="kw">str_detect</span>(files, <span class="st">&quot;us&quot;</span>)]
vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;dvage&quot;</span>, <span class="st">&quot;vote6&quot;</span>, <span class="st">&quot;fimnnet_dv&quot;</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) {
        varsToSelect &lt;-<span class="st"> </span><span class="kw">paste</span>(letters[i], vars, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
        varsToSelect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;pidp&quot;</span>, varsToSelect)
        data &lt;-<span class="st"> </span><span class="kw">fread</span>(files[i], <span class="dt">select =</span> varsToSelect)
        <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
                all7 &lt;-<span class="st"> </span>data  
        }
        <span class="cf">else</span> {
                all7 &lt;-<span class="st"> </span><span class="kw">full_join</span>(all7, data, <span class="dt">by =</span> <span class="st">&quot;pidp&quot;</span>)
        }
        <span class="kw">rm</span>(data)
}
<span class="co"># Reshaping the data into the long format</span>
<span class="co"># Note the use of the extra = &quot;merge&quot; argument with separate.</span>
<span class="co"># It prevents splitting the &quot;fimnnet_dv&quot; string.</span>

UndSocLong &lt;-<span class="st"> </span>all7 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(a_sex<span class="op">:</span>g_fimnnet_dv, <span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(variable, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> variable, <span class="dt">value =</span> value)
<span class="co"># Cleaning the data</span>
UndSocLong  &lt;-<span class="st"> </span>UndSocLong <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dvage =</span> <span class="kw">ifelse</span>(dvage <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dvage, <span class="ot">NA</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">ifelse</span>(sex <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, sex, <span class="ot">NA</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vote6 =</span> <span class="kw">ifelse</span>(vote6 <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, vote6, <span class="ot">NA</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">recode</span>(sex, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;male&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;female&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vote6 =</span> <span class="kw">recode</span>(vote6, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;very&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;fairly&quot;</span>, <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;not very&quot;</span>, <span class="st">&quot;4&quot;</span> =<span class="st"> &quot;not al all&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">factor</span>(sex)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vote6 =</span> <span class="kw">factor</span>(vote6))

<span class="co"># Let&#39;s write this data frame into myData </span>
<span class="kw">write_tsv</span>(UndSocLong, <span class="st">&quot;myData/all7new.tab&quot;</span>)</code></pre></div>
<p>Note that net income can be negative (I am not sure why).</p>
</div>
<div id="visualising-income" class="section level2">
<h2><span class="header-section-number">7.2</span> Visualising income</h2>
<p>Now we want to visualise the distribution of income. There are several ways of doing this.</p>
<p>First, we can create box plots for each wave.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(UndSocLong, <span class="kw">aes</span>(<span class="dt">x =</span> wave, <span class="dt">y=</span> fimnnet_dv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Wave&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Net monthly income&quot;</span>)</code></pre></div>
<pre><code>## Warning: Removed 249806 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="datan3_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>The chart does not look nice because of the outliers. We can either remove the outliers or display only a specified range of the box plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(UndSocLong, <span class="kw">aes</span>(<span class="dt">x =</span> wave, <span class="dt">y=</span> fimnnet_dv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Wave&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="dv">500</span>, <span class="dv">5000</span>)</code></pre></div>
<pre><code>## Warning: Removed 255340 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="datan3_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>We can see that the median income has been slowly increasing.</p>
<p>Another way to display these data is a density plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(UndSocLong, <span class="kw">aes</span>(<span class="dt">x =</span> fimnnet_dv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="op">-</span><span class="dv">500</span>, <span class="dv">5000</span>)</code></pre></div>
<pre><code>## Warning: Removed 255340 rows containing non-finite values (stat_density).</code></pre>
<p><img src="datan3_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>We see a peak at zero incomes, and for positive incomes the distribution is close to normal.</p>
<p>We can also create this chart for each wave separately.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(UndSocLong, <span class="kw">aes</span>(<span class="dt">x =</span> fimnnet_dv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="op">-</span><span class="dv">500</span>, <span class="dv">5000</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>wave)</code></pre></div>
<pre><code>## Warning: Removed 255340 rows containing non-finite values (stat_density).</code></pre>
<p><img src="datan3_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>Now we may want to visualise the change of income across the waves.</p>
<p>We can plot the income trajectories for each individual in the data set. Let us do this for the first five individuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 5 individuals, 7 waves: 5*7 = 35</span>
first5 &lt;-<span class="st"> </span>UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">35</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">select</span>(pidp, wave, fimnnet_dv)
<span class="kw">kable</span>(first5)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">pidp</th>
<th align="left">wave</th>
<th align="right">fimnnet_dv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">22445</td>
<td align="left">a</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">22445</td>
<td align="left">b</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">22445</td>
<td align="left">c</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">22445</td>
<td align="left">d</td>
<td align="right">1140.000</td>
</tr>
<tr class="odd">
<td align="right">22445</td>
<td align="left">e</td>
<td align="right">1602.667</td>
</tr>
<tr class="even">
<td align="right">22445</td>
<td align="left">f</td>
<td align="right">2012.000</td>
</tr>
<tr class="odd">
<td align="right">22445</td>
<td align="left">g</td>
<td align="right">1840.000</td>
</tr>
<tr class="even">
<td align="right">29925</td>
<td align="left">a</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">29925</td>
<td align="left">b</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">29925</td>
<td align="left">c</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">29925</td>
<td align="left">d</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">29925</td>
<td align="left">e</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">29925</td>
<td align="left">f</td>
<td align="right">2537.080</td>
</tr>
<tr class="even">
<td align="right">29925</td>
<td align="left">g</td>
<td align="right">2076.867</td>
</tr>
<tr class="odd">
<td align="right">76165</td>
<td align="left">a</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">76165</td>
<td align="left">b</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">76165</td>
<td align="left">c</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">76165</td>
<td align="left">d</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">76165</td>
<td align="left">e</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">76165</td>
<td align="left">f</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">76165</td>
<td align="left">g</td>
<td align="right">1804.167</td>
</tr>
<tr class="even">
<td align="right">223725</td>
<td align="left">a</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">223725</td>
<td align="left">b</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">223725</td>
<td align="left">c</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">223725</td>
<td align="left">d</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">223725</td>
<td align="left">e</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">223725</td>
<td align="left">f</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">223725</td>
<td align="left">g</td>
<td align="right">3066.602</td>
</tr>
<tr class="odd">
<td align="right">280165</td>
<td align="left">a</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">280165</td>
<td align="left">b</td>
<td align="right">1183.872</td>
</tr>
<tr class="odd">
<td align="right">280165</td>
<td align="left">c</td>
<td align="right">2367.884</td>
</tr>
<tr class="even">
<td align="right">280165</td>
<td align="left">d</td>
<td align="right">2828.061</td>
</tr>
<tr class="odd">
<td align="right">280165</td>
<td align="left">e</td>
<td align="right">2324.167</td>
</tr>
<tr class="even">
<td align="right">280165</td>
<td align="left">f</td>
<td align="right">2335.695</td>
</tr>
<tr class="odd">
<td align="right">280165</td>
<td align="left">g</td>
<td align="right">3049.700</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(first5, <span class="kw">aes</span>(<span class="dt">x =</span> wave, <span class="dt">y =</span> fimnnet_dv, <span class="dt">colour =</span> <span class="kw">as.factor</span>(pidp))) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> pidp), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="datan3_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>This chart nicely illustrates individual income trajectories, but if we try this for even 100 people the chart will be a complete mess.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">700</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> wave, <span class="dt">y =</span> fimnnet_dv, <span class="dt">group =</span> pidp)) <span class="op">+</span>
<span class="st">                </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_line</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">                </span><span class="kw">ylab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">xlab</span>(<span class="st">&quot;Wave&quot;</span>)</code></pre></div>
<p><img src="datan3_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>Instead we can visualise summary statistics, such as mean or median. For a variable with outliers such as income median would be a better summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we create a data frame of medians.</span>
medians &lt;-<span class="st"> </span>UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(wave) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarise</span>(
                <span class="dt">medianIncome =</span> <span class="kw">median</span>(fimnnet_dv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
        )
<span class="kw">kable</span>(medians)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">wave</th>
<th align="right">medianIncome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">a</td>
<td align="right">1011.622</td>
</tr>
<tr class="even">
<td align="left">b</td>
<td align="right">1087.900</td>
</tr>
<tr class="odd">
<td align="left">c</td>
<td align="right">1150.000</td>
</tr>
<tr class="even">
<td align="left">d</td>
<td align="right">1183.333</td>
</tr>
<tr class="odd">
<td align="left">e</td>
<td align="right">1200.000</td>
</tr>
<tr class="even">
<td align="left">f</td>
<td align="right">1231.594</td>
</tr>
<tr class="odd">
<td align="left">g</td>
<td align="right">1299.812</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Then visualize.</span>
<span class="co"># We need to add group = 1 because wave is not numeric</span>
<span class="kw">ggplot</span>(medians, <span class="kw">aes</span>(<span class="dt">x =</span> wave, <span class="dt">y =</span> medianIncome, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;Median net monthly income&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">xlab</span>(<span class="st">&quot;Wave&quot;</span>)</code></pre></div>
<p><img src="datan3_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>There are a number of things we may want to do with this chart. First, we may want to change wave to year. Second, we may want to display confidence intervals for the point estimates.</p>
<p>First, let us create a variable for year. We need to do this in the original data frame. For each wave in the Understanding Society, the data were collected for two years. So for Wave 1 the field work was conducted in 2009 and 2010. For simplicity, I will code the first year only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLong &lt;-<span class="st"> </span>UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">recode</span>(wave, <span class="st">&quot;a&quot;</span> =<span class="st"> &quot;2009&quot;</span>,
                             <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;2010&quot;</span>,
                             <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;2011&quot;</span>,
                             <span class="st">&quot;d&quot;</span> =<span class="st"> &quot;2012&quot;</span>,
                             <span class="st">&quot;e&quot;</span> =<span class="st"> &quot;2013&quot;</span>,
                             <span class="st">&quot;f&quot;</span> =<span class="st"> &quot;2014&quot;</span>,
                             <span class="st">&quot;g&quot;</span> =<span class="st"> &quot;2015&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.numeric</span>(year))</code></pre></div>
<p>Producing confidence intervals for the median is not straightforward (you need to use statistical simulation or some other statistical tricks) so I’ll use the mean instead.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarise</span>(
                <span class="co"># I use the function t.test to get the means and standard errors</span>
                <span class="dt">meanIncome =</span> <span class="kw">t.test</span>(fimnnet_dv)<span class="op">$</span>estimate,
                <span class="co"># Here I calculate the 95% confidence interval</span>
                <span class="dt">lowerIncome =</span> <span class="kw">t.test</span>(fimnnet_dv)<span class="op">$</span>conf.int[<span class="dv">1</span>],
                <span class="dt">upperIncome =</span> <span class="kw">t.test</span>(fimnnet_dv)<span class="op">$</span>conf.int[<span class="dv">2</span>]
        ) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="co"># and now I visualise</span>
<span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> meanIncome)) <span class="op">+</span>
<span class="st">                </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">                </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>lowerIncome, <span class="dt">ymax=</span>upperIncome), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">ylab</span>(<span class="st">&quot;Median net monthly income&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="datan3_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>The confidence intervals are quite wide. This is not surprising given our sample size.</p>
<p>Another chart we can produce is not only for the medians (or means), but for different quantiles. Let us take the following quantiles: 0.01, 0.05, 0.1, 0.5. 0.9, 0.95, 0.99. This will show the change in income for the 1% poorest, 5% poorest, 10% poorest, etc.</p>
<p>This can be done in several ways. If we use summarise to produce multiple quantiles it can get clumsy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarise</span>(
                <span class="dt">quant1 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.01</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">quant5 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.05</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">quant10 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.1</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">quant50 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.5</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">quant90 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.9</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">quant95 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.95</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">quant99 =</span> <span class="kw">quantile</span>(fimnnet_dv, <span class="fl">0.99</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
        ) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">        </span><span class="co"># Now I need to convert this to a long format</span>
<span class="st">        </span><span class="kw">gather</span>(quantile, value, quant1<span class="op">:</span>quant99) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="co"># and plot</span>
<span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> value, <span class="dt">colour =</span> quantile)) <span class="op">+</span>
<span class="st">                </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_line</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">                </span><span class="kw">ylab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="datan3_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>A more economical way to write the code is the following. This time I will also select only people with positive net incomes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
UndSocLong <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(fimnnet_dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">nest</span>(<span class="op">-</span>year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Quantiles =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">quantile</span>(.<span class="op">$</span>fimnnet_dv,
                                       <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>)))) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">unnest</span>(<span class="kw">map</span>(Quantiles, tidy)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> x, <span class="dt">colour =</span> names)) <span class="op">+</span>
<span class="st">                </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">geom_line</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">                </span><span class="kw">ylab</span>(<span class="st">&quot;Net monthly income&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="datan3_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datavis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
